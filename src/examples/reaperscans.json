{
  "$schema": "file:///C:/Users/Dipu/Projects/celeref-parser/src/schema/schema.json",

  "app": {
    "block": [
      {
        "set": {
          "version": 1,
          "name": "Reaper Scans",
          "base_url": ["https://reaperscans.com"],
          "icon_url": "https://reaperscans.com/storage/android-icon-192x192.png"
        }
      },
      {
        "method": {
          "name": "fetch_catalog",
          "block": [
            { "set-state": "https://reaperscans.com/comics" },
            {
              "call": {
                "method": "browser.fetch_soup",
                "args": ["#{state}"]
              }
            },
            { "save-state": "soup" },
            {
              "dot-call": {
                "method": "select",
                "args": ["#content .row > .text-muted"]
              }
            },
            {
              "loop": [
                { "save-state": "item" },
                {
                  "dot-call": {
                    "method": "select_one",
                    "args": ["a.list-title"]
                  }
                },
                { "save-state": "title_elem" },
                { "dot": "text" },
                { "save-state": "title" },
                { "load-state": "title_elem" },
                { "at": "href" },
                { "save-state": "url" },
                { "load-state": "item" },
                {
                  "dot-call": {
                    "method": "select_one",
                    "args": ["a.media-content"]
                  }
                },
                { "at": "style" },
                {
                  "call": {
                    "method": "re.find_all",
                    "args": ["url\\((.*)\\)"]
                  }
                },
                { "at": 0 },
                { "save-state": "cover_url" },
                {
                  "set": {
                    "block:result": {
                      "title": "#{title}",
                      "url": "#{url}",
                      "cover_url": "#{cover_url}"
                    }
                  }
                }
              ]
            },
            {
              "set": {
                "block:result": "#{state}"
              }
            }
          ]
        }
      },
      {
        "call": {
          "method": "fetch_catalog"
        }
      }
    ]
  }
}
